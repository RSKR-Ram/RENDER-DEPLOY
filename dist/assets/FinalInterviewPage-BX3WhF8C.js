import{a as T,r,j as s,A as k,S as E,M as P,a3 as D,n as p,a4 as _}from"./index-DseEmN6k.js";import{C as S}from"./Collapsible-DwzN-K4i.js";function A(l){if(!l)return"";const i=l instanceof Date?l:new Date(l);return Number.isNaN(i.getTime())?String(l):i.toLocaleString()}function L(){const{token:l,role:i,legacyRole:N,canPortal:f,canAction:y}=T();function R(e,n){const a=typeof f=="function"?f(e):null;if(a===!0||a===!1)return a;const t=String(N||i||"").toUpperCase();return Array.isArray(n)?n.includes(t):!1}function u(e,n){const a=typeof y=="function"?y(e):null;if(a===!0||a===!1)return a;const t=String(N||i||"").toUpperCase();return Array.isArray(n)?n.includes(t):!1}const m=R("PORTAL_HR_FINAL",["HR","ADMIN"]),[x,v]=r.useState(!1),[d,j]=r.useState([]),[g,h]=r.useState("PASSED"),[b,I]=r.useState("");async function w(){if(m&&u("FINAL_INTERVIEW_LIST",["HR","ADMIN"])){v(!0);try{const e=await D(l);j(e.items??[])}catch(e){p.error((e==null?void 0:e.message)||"Failed to load")}finally{v(!1)}}}r.useEffect(()=>{w()},[m]);const c=r.useMemo(()=>d.filter(e=>String(e.status||"").toUpperCase()!=="FINAL_OWNER_PENDING"),[d]),o=r.useMemo(()=>d.filter(e=>String(e.status||"").toUpperCase()==="FINAL_OWNER_PENDING"),[d]);async function O(e){if(!u("FINAL_SEND_OWNER",["HR","ADMIN"])){p.error("Not allowed");return}const n=`${e.requirementId}:${e.candidateId}:SEND_OWNER`;I(n);try{await _(l,{requirementId:e.requirementId,candidateId:e.candidateId}),p.success("Sent to Owner"),j(a=>a.map(t=>t.candidateId===e.candidateId?{...t,status:"FINAL_OWNER_PENDING"}:t)),h("PENDING_OWNER")}catch(a){p.error((a==null?void 0:a.message)||"Failed")}finally{I("")}}return s.jsxs(k,{children:[m?null:s.jsxs("div",{className:"card",style:{padding:12,marginBottom:12},children:[s.jsx("div",{style:{fontWeight:700},children:"Not allowed"}),s.jsx("div",{className:"small",style:{color:"var(--gray-600)"},children:"You don’t have access to Final Interview portal."})]}),s.jsxs("div",{style:{marginBottom:"20px"},children:[s.jsx("h1",{className:"page-title",children:"Final Interview"}),s.jsx("p",{className:"page-subtitle",children:"Candidates who passed technical tests"})]}),s.jsxs("div",{className:"card",style:{marginBottom:"16px"},children:[s.jsxs("div",{className:"row",style:{gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[s.jsxs("button",{className:"button",onClick:w,disabled:x,style:{display:"flex",alignItems:"center",gap:6},children:[x?s.jsx(E,{size:14}):null,"Refresh"]}),s.jsx("div",{style:{marginLeft:"auto"},children:s.jsxs("span",{className:"badge",children:[d.length," candidates"]})})]}),s.jsx("div",{style:{height:12}}),s.jsxs("div",{className:"tabs",children:[s.jsxs("button",{type:"button",className:["tab",g==="PASSED"?"active":""].join(" "),onClick:()=>h("PASSED"),children:["Passed (",c.length,")"]}),s.jsxs("button",{type:"button",className:["tab",g==="PENDING_OWNER"?"active":""].join(" "),onClick:()=>h("PENDING_OWNER"),children:["Pending Owner (",o.length,")"]})]})]}),x?s.jsx(P,{text:"Loading candidates..."}):s.jsx(s.Fragment,{children:g==="PASSED"?s.jsx(S,{title:"Ready for Final Interview",subtitle:"Send these candidates to Owner for final interview",badge:c.length,variant:"card",defaultOpen:!0,children:c.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx("div",{className:"empty-state-icon",children:"✅"}),s.jsx("div",{className:"empty-state-text",children:"No candidates ready"})]}):s.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:c.map(e=>{const n=`${e.requirementId}:${e.candidateId}:SEND_OWNER`;return s.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:s.jsxs("div",{className:"row",style:{justifyContent:"space-between",gap:12,flexWrap:"wrap",alignItems:"center"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontWeight:700,fontSize:"15px"},children:e.candidateName}),s.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:[e.jobTitle?`${e.jobTitle} · `:"",e.jobRole," · ",e.mobile]}),s.jsxs("div",{style:{marginTop:6,display:"flex",gap:8,flexWrap:"wrap"},children:[s.jsxs("span",{className:"badge",style:{background:"#22c55e",color:"#fff"},children:["In-person: ",e.inPersonMarks,"/10"]}),e.tallyMarks!==""&&e.tallyMarks!=null?s.jsxs("span",{className:"badge",children:["Tally: ",e.tallyMarks,"/10"]}):null,e.voiceMarks!==""&&e.voiceMarks!=null?s.jsxs("span",{className:"badge",children:["Voice: ",e.voiceMarks,"/10"]}):null,e.excelMarks!==""&&e.excelMarks!=null?s.jsxs("span",{className:"badge",children:["Excel: ",e.excelMarks,"/10"]}):null,e.techReview||e.excelReview?s.jsxs("div",{className:"small",style:{marginTop:6},children:[e.techReview?s.jsxs("div",{children:["Tech Review: ",e.techReview]}):null,e.excelReview?s.jsxs("div",{children:["Excel Review: ",e.excelReview]}):null]}):null,e.techEvaluatedAt?s.jsxs("span",{className:"badge",children:["Tech Passed: ",A(e.techEvaluatedAt)]}):null]})]}),s.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:s.jsxs("button",{className:"button primary",type:"button",onClick:()=>O(e),disabled:!!b||!u("FINAL_SEND_OWNER",["HR","ADMIN"]),children:[b===n?s.jsx(E,{size:14}):null,"Send to Owner"]})})]})},e.candidateId)})})}):s.jsx(S,{title:"Pending Final Interview (Owner)",subtitle:"Waiting for Owner's final decision",badge:o.length,variant:"card",defaultOpen:!0,children:o.length===0?s.jsxs("div",{className:"empty-state",children:[s.jsx("div",{className:"empty-state-icon",children:"⏳"}),s.jsx("div",{className:"empty-state-text",children:"No candidates pending"})]}):s.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:o.map(e=>s.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:[s.jsx("div",{style:{fontWeight:700,fontSize:"15px"},children:e.candidateName}),s.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:[e.jobTitle?`${e.jobTitle} · `:"",e.jobRole," · ",e.mobile]}),s.jsxs("div",{style:{marginTop:6,display:"flex",gap:8,flexWrap:"wrap"},children:[s.jsxs("span",{className:"badge",style:{background:"#22c55e",color:"#fff"},children:["In-person: ",e.inPersonMarks,"/10"]}),e.techEvaluatedAt?s.jsxs("span",{className:"badge",children:["Tech Passed: ",A(e.techEvaluatedAt)]}):null]}),s.jsx("div",{style:{marginTop:12,padding:"10px 12px",background:"#fef3c7",borderRadius:"var(--radius)",fontSize:"13px"},children:"⏳ Pending Final Interview (Owner) — Locked"})]},e.candidateId))})})})]})}export{L as FinalInterviewPage};
