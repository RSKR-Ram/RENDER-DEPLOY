import{a as se,r as o,j as t,A as ae,S as m,M as ne,D as n,N as le,O as re,P as B,Q as ie}from"./index-DseEmN6k.js";import{C as K}from"./Collapsible-DwzN-K4i.js";import{v as de}from"./scheduling-mgpGDE0C.js";import{o as oe}from"./files-mIOWSNJZ.js";function Ne(){var P,U,H,V,$,q,z;const{token:N,legacyRole:j,canPortal:k,canAction:W,canUi:D}=se();function J(e,s){const a=typeof k=="function"?k(e):null;if(a===!0||a===!1)return a;const l=String(j||"").toUpperCase();return(Array.isArray(s)?s:[]).includes(l)}function r(e,s){const a=typeof W=="function"?W(e):null;if(a===!0||a===!1)return a;const l=String(j||"").toUpperCase();return(Array.isArray(s)?s:[]).includes(l)}function L(e,s){const a=typeof D=="function"?D(e):null;if(a===!0||a===!1)return a;const l=String(j||"").toUpperCase();return(Array.isArray(s)?s:[]).includes(l)}function T(e,s){try{const a=JSON.parse(String((e==null?void 0:e.testDecisionsJson)||"{}")),l=a==null?void 0:a[s];return String((l==null?void 0:l.decision)||"").toUpperCase()==="CONTINUE"}catch{return!1}}function h(e){const s=Number(e);return Number.isFinite(s)?s>=6?"PASS":"FAIL":null}const G=o.useMemo(()=>[{key:"APPROVE",label:"Approve"},{key:"FINAL",label:"Final"}],[]),[S,Q]=o.useState("APPROVE"),[I,_]=o.useState(!1),[R,Y]=o.useState([]),[d,y]=o.useState({open:!1,mode:"OWNER",candidate:null}),[b,A]=o.useState(""),[O,C]=o.useState(""),[i,c]=o.useState("");async function g(){if(!r("OWNER_CANDIDATES_LIST",["OWNER","ADMIN"])){n.error("Not allowed");return}_(!0);try{const e=await le(N);Y(e.items||[])}catch(e){n.error((e==null?void 0:e.message)||"Failed to load")}finally{_(!1)}}o.useEffect(()=>{g()},[]);function X(e){y({open:!0,mode:"OWNER",candidate:e}),A(""),C("")}function Z(e){y({open:!0,mode:"FINAL",candidate:e}),A(""),C("")}function F(e){if(!(e!=null&&e.cvFileId)){n.error("CV not available");return}oe(e.cvFileId,N)||n.error("Unable to open CV")}async function w(e){if(!r("OWNER_DECIDE",["OWNER","ADMIN"])){n.error("Not allowed");return}if(e==="APPROVE_WALKIN"&&!L("BTN_OWNER_APPROVE_WALKIN",["OWNER","ADMIN"])){n.error("Not allowed");return}const s=d.candidate;if(!s)return;const a=s.requirementId,l=s.candidateId,u=String(b||"").trim();let E=null;if(e==="REJECT"&&!u){n.error("Remark required");return}if(e==="HOLD"){if(!O){n.error("Select hold deadline");return}const p=de(O);if(!p.ok){n.error(p.message);return}E=p.date}const x=`${l}:${e}`;c(x);try{await ie(N,{requirementId:a,candidateId:l,decision:e==="APPROVE_WALKIN"?"APPROVE_WALKIN":e,remark:u,holdUntil:e==="HOLD"?E.toISOString():void 0}),n.success("Updated"),y({open:!1,mode:"OWNER",candidate:null}),await g()}catch(p){n.error((p==null?void 0:p.message)||"Failed")}finally{c("")}}async function M(e){if(!r("OWNER_FINAL_DECIDE",["OWNER","ADMIN"])){n.error("Not allowed");return}const s=d.candidate;if(!s)return;const a=s.requirementId,l=s.candidateId,u=String(b||"").trim();if(e==="REJECT"&&!u){n.error("Remark required");return}const E=`${l}:FINAL:${e}`;c(E);try{await B(N,{requirementId:a,candidateId:l,decision:e,remark:u}),n.success("Updated"),y({open:!1,mode:"FINAL",candidate:null}),await g()}catch(x){n.error((x==null?void 0:x.message)||"Failed")}finally{c("")}}async function ee(e){if(!r("OWNER_FINAL_DECIDE",["OWNER","ADMIN"])){n.error("Not allowed");return}const s=`${e.candidateId}:FINAL:SELECT`;c(s);try{await B(N,{requirementId:e.requirementId,candidateId:e.candidateId,decision:"SELECT",remark:""}),n.success("Selected"),await g()}catch(a){n.error((a==null?void 0:a.message)||"Failed")}finally{c("")}}async function te(e){if(!r("HOLD_REVERT",["OWNER","ADMIN"])){n.error("Not allowed");return}const s=`${e.candidateId}:REVERT`;c(s);try{await re(N,{requirementId:e.requirementId,candidateId:e.candidateId,remark:"Revert"}),n.success("Reverted"),await g()}catch(a){n.error((a==null?void 0:a.message)||"Revert failed")}finally{c("")}}const f=R.filter(e=>{const s=String(e.status||"").toUpperCase();return s==="OWNER"||s==="OWNER_HOLD"}),v=R.filter(e=>String(e.status||"").toUpperCase()==="FINAL_OWNER_PENDING");return t.jsxs(ae,{children:[J("PORTAL_OWNER",["OWNER","ADMIN"])?null:t.jsxs("div",{className:"card",style:{padding:12,marginBottom:12},children:[t.jsx("div",{style:{fontWeight:700},children:"Not allowed"}),t.jsx("div",{className:"small",style:{color:"var(--gray-600)"},children:"You donâ€™t have access to Owner portal."})]}),t.jsxs("div",{style:{marginBottom:"20px"},children:[t.jsx("h1",{className:"page-title",children:"Owner Portal"}),t.jsx("p",{className:"page-subtitle",children:"Review and make decisions on candidates"})]}),t.jsxs("div",{className:"card",style:{marginBottom:"16px"},children:[t.jsxs("div",{className:"row",style:{gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[t.jsxs("button",{className:"button",onClick:g,disabled:I,style:{display:"flex",alignItems:"center",gap:6},children:[I?t.jsx(m,{size:14}):null,"Refresh"]}),t.jsx("div",{style:{marginLeft:"auto"},children:t.jsxs("span",{className:"badge",children:[R.length," candidates"]})})]}),t.jsx("div",{style:{height:12}}),t.jsx("div",{className:"tabs",children:G.map(e=>t.jsxs("button",{type:"button",className:["tab",S===e.key?"active":""].join(" "),onClick:()=>Q(e.key),children:[e.label," (",e.key==="APPROVE"?f.length:v.length,")"]},e.key))})]}),I?t.jsx(ne,{text:"Loading candidates..."}):t.jsx(t.Fragment,{children:S==="APPROVE"?t.jsx(K,{title:"Candidates for Approval",subtitle:"Approve, hold, or reject candidate applications",badge:f.length,variant:"card",defaultOpen:!0,children:f.length===0?t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state-icon",children:"ðŸ“‹"}),t.jsx("div",{className:"empty-state-text",children:"No candidates pending approval"})]}):t.jsx("div",{style:{display:"grid",gap:10},children:f.map(e=>{const s=String(e.status||"").toUpperCase(),a=s==="OWNER_HOLD",l=e.holdUntil?new Date(e.holdUntil).toLocaleString():"";return t.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:t.jsxs("div",{className:"row",style:{justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{fontWeight:700,fontSize:"15px"},children:[e.candidateName,t.jsxs("span",{className:"small",style:{fontWeight:400,marginLeft:8,color:"var(--gray-500)"},children:["(",e.candidateId,")"]})]}),t.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:[e.jobRole||"-"," Â· ",e.mobile||"-"," Â· ",e.source||"-"]}),t.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:[t.jsxs("span",{className:"badge",children:["Req: ",e.requirementId]}),t.jsx("span",{className:"badge",style:{background:a?"#f59e0b":"var(--primary)",color:"#fff"},children:s})]}),a&&l&&t.jsxs("div",{className:"small",style:{marginTop:6,color:"var(--gray-600)"},children:["â° Hold deadline: ",l]})]}),t.jsxs("div",{className:"action-grid",children:[t.jsx("button",{className:"button",type:"button",onClick:()=>F(e),children:"ðŸ“„ CV"}),a?t.jsxs("button",{className:"button",type:"button",onClick:()=>te(e),disabled:!!i||!r("HOLD_REVERT",["OWNER","ADMIN"]),children:[i===`${e.candidateId}:REVERT`?t.jsx(m,{size:14}):null,"Revert"]}):t.jsx("button",{className:"button primary",type:"button",onClick:()=>{if(!r("OWNER_DECIDE",["OWNER","ADMIN"])){n.error("Not allowed");return}X(e)},disabled:!r("OWNER_DECIDE",["OWNER","ADMIN"]),children:"Actions"})]})]})},e.candidateId)})})}):t.jsx(K,{title:"Final Decision",subtitle:"Make final hiring decisions for candidates",badge:v.length,variant:"card",defaultOpen:!0,children:v.length===0?t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-state-icon",children:"âš–ï¸"}),t.jsx("div",{className:"empty-state-text",children:"No candidates pending final decision"})]}):t.jsx("div",{style:{display:"grid",gap:10},children:v.map(e=>{const s=Array.isArray(e.techSelectedTests)?e.techSelectedTests:[];return t.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:t.jsxs("div",{className:"row",style:{justifyContent:"space-between",gap:12,flexWrap:"wrap",alignItems:"flex-start"},children:[t.jsxs("div",{style:{minWidth:280,flex:1},children:[t.jsxs("div",{style:{fontWeight:700,fontSize:"15px"},children:[e.candidateName,t.jsxs("span",{className:"small",style:{fontWeight:400,marginLeft:8,color:"var(--gray-500)"},children:["(",e.candidateId,")"]})]}),t.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:[e.jobTitle?`${e.jobTitle} Â· `:"",e.jobRole||"-"," Â· ",e.mobile||"-"]}),t.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:[t.jsxs("span",{className:"badge",children:["Req: ",e.requirementId]}),t.jsx("span",{className:"badge",style:{background:"var(--primary)",color:"#fff"},children:"Final Decision"})]}),t.jsxs("div",{style:{marginTop:12,padding:"10px 12px",background:"var(--gray-100)",borderRadius:"var(--radius)"},children:[t.jsx("div",{className:"small",style:{fontWeight:600,marginBottom:6},children:"Scores"}),t.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[t.jsxs("span",{className:"badge",style:{background:String(e.onlineTestResult||"").toUpperCase()==="PASS"?"#22c55e":String(e.onlineTestResult||"").toUpperCase()==="FAIL"?"#ef4444":void 0,color:String(e.onlineTestResult||"").toUpperCase()?"#fff":void 0},children:["Online Test: ",e.onlineTestScore||"-",e.onlineTestResult?` (${String(e.onlineTestResult).toUpperCase()})`:""]}),String(e.onlineTestResult||"").toUpperCase()==="FAIL"&&T(e,"ONLINE_TEST")?t.jsx("span",{className:"badge",style:{background:"#f59e0b",color:"#fff"},children:"Continued by HR"}):null,e.preInterviewMarks&&t.jsxs("span",{className:"badge",children:["Pre-interview: ",e.preInterviewMarks]}),e.inPersonMarks&&t.jsxs("span",{className:"badge",children:["In-person: ",e.inPersonMarks]})]}),s.length>0&&t.jsxs("div",{className:"small",style:{marginTop:6},children:["Tech Tests: ",s.join(", ")]}),t.jsxs("div",{className:"small",style:{marginTop:4},children:["Marks:"," ","Tally ",e.tallyMarks||"-",h(e.tallyMarks)?` (${h(e.tallyMarks)})`:""," ","Â· Voice ",e.voiceMarks||"-",h(e.voiceMarks)?` (${h(e.voiceMarks)})`:""," ","Â· Excel ",e.excelMarks||"-",h(e.excelMarks)?` (${h(e.excelMarks)})`:""]}),t.jsxs("div",{className:"small",style:{marginTop:4},children:["Tech Result: ",t.jsx("strong",{children:String(e.techResult||"-").toUpperCase()}),e.techEvaluatedAt&&` Â· ${new Date(e.techEvaluatedAt).toLocaleString()}`,String(e.techResult||"").toUpperCase()==="FAIL"&&T(e,"TECHNICAL")?t.jsx("span",{style:{marginLeft:8,color:"var(--gray-600)"},children:"(Continued by HR)"}):null]}),e.techReview||e.excelReview?t.jsxs("div",{className:"small",style:{marginTop:4},children:[e.techReview?t.jsxs("div",{children:["Tech Review: ",e.techReview]}):null,e.excelReview?t.jsxs("div",{children:["Excel Review: ",e.excelReview]}):null]}):null]})]}),t.jsxs("div",{className:"action-grid",style:{minWidth:180},children:[t.jsx("button",{className:"button",type:"button",onClick:()=>F(e),children:"ðŸ“„ CV"}),t.jsxs("button",{className:"button primary",type:"button",onClick:()=>ee(e),disabled:!!i||!r("OWNER_FINAL_DECIDE",["OWNER","ADMIN"]),children:[i===`${e.candidateId}:FINAL:SELECT`?t.jsx(m,{size:14}):null,"Select"]}),t.jsx("button",{className:"button",type:"button",onClick:()=>{if(!r("OWNER_FINAL_DECIDE",["OWNER","ADMIN"])){n.error("Not allowed");return}Z(e)},disabled:!r("OWNER_FINAL_DECIDE",["OWNER","ADMIN"]),children:"Hold / Reject"})]})]})},e.candidateId)})})})}),d.open&&t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",display:"grid",placeItems:"center",padding:16,zIndex:60},onClick:()=>y({open:!1,mode:"OWNER",candidate:null}),children:t.jsxs("div",{className:"card",style:{width:"min(520px, 95vw)",maxHeight:"90vh",overflow:"auto"},onClick:e=>e.stopPropagation(),children:[t.jsx("h3",{style:{marginTop:0,marginBottom:4},children:d.mode==="FINAL"?"Owner Final Decision":"Owner Decision"}),t.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginBottom:16},children:[(P=d.candidate)==null?void 0:P.candidateName," (",(U=d.candidate)==null?void 0:U.candidateId,")"]}),t.jsxs("div",{style:{display:"grid",gap:12},children:[d.mode!=="FINAL"&&t.jsxs("div",{children:[t.jsx("label",{className:"small",style:{fontWeight:600,display:"block",marginBottom:4},children:"Hold deadline (required for Hold)"}),t.jsx("input",{type:"datetime-local",value:O,onChange:e=>C(e.target.value),style:{width:"100%"}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"small",style:{fontWeight:600,display:"block",marginBottom:4},children:"Remark (required for Reject)"}),t.jsx("textarea",{rows:3,value:b,onChange:e=>A(e.target.value),style:{width:"100%"},placeholder:"Enter remark..."})]})]}),t.jsxs("div",{style:{marginTop:16,display:"flex",gap:8,justifyContent:"flex-end",flexWrap:"wrap"},children:[d.mode==="FINAL"?t.jsxs(t.Fragment,{children:[t.jsxs("button",{className:"button",type:"button",onClick:()=>M("HOLD"),disabled:!!i,children:[i===`${(H=d.candidate)==null?void 0:H.candidateId}:FINAL:HOLD`?t.jsx(m,{size:14}):null,"Hold"]}),t.jsxs("button",{className:"button danger",type:"button",onClick:()=>M("REJECT"),disabled:!!i,children:[i===`${(V=d.candidate)==null?void 0:V.candidateId}:FINAL:REJECT`?t.jsx(m,{size:14}):null,"Reject"]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("button",{className:"button primary",type:"button",onClick:()=>w("APPROVE_WALKIN"),disabled:!!i||!r("OWNER_DECIDE",["OWNER","ADMIN"])||!L("BTN_OWNER_APPROVE_WALKIN",["OWNER","ADMIN"]),children:[i===`${($=d.candidate)==null?void 0:$.candidateId}:APPROVE_WALKIN`?t.jsx(m,{size:14}):null,"Approve"]}),t.jsxs("button",{className:"button",type:"button",onClick:()=>w("HOLD"),disabled:!!i||!r("OWNER_DECIDE",["OWNER","ADMIN"]),children:[i===`${(q=d.candidate)==null?void 0:q.candidateId}:HOLD`?t.jsx(m,{size:14}):null,"Hold"]}),t.jsxs("button",{className:"button danger",type:"button",onClick:()=>w("REJECT"),disabled:!!i||!r("OWNER_DECIDE",["OWNER","ADMIN"]),children:[i===`${(z=d.candidate)==null?void 0:z.candidateId}:REJECT`?t.jsx(m,{size:14}):null,"Reject"]})]}),t.jsx("button",{className:"button",type:"button",onClick:()=>y({open:!1,mode:"OWNER",candidate:null}),children:"Close"})]})]})})]})}export{Ne as OwnerPage};
