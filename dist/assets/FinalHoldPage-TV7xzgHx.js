import{a as R,r as c,j as e,A as T,S as C,M as F,a5 as E,n as d,a6 as _}from"./index-Dn7xk2-6.js";import{C as O}from"./Collapsible-BtIsWir-.js";import{v as W}from"./scheduling-mgpGDE0C.js";import{o as M}from"./files-Tp243tmQ.js";function U(l){if(!l)return"";const r=l instanceof Date?l:new Date(l);if(Number.isNaN(r.getTime()))return"";const o=f=>String(f).padStart(2,"0"),p=r.getFullYear(),h=o(r.getMonth()+1),x=o(r.getDate()),m=o(r.getHours()),u=o(r.getMinutes());return`${p}-${h}-${x}T${m}:${u}`}function $(l){if(!l)return"";const r=l instanceof Date?l:new Date(l);return Number.isNaN(r.getTime())?String(l):r.toLocaleString()}function z(){const{token:l,role:r,legacyRole:o,canPortal:p,canAction:h}=R();function x(a,t){const s=typeof p=="function"?p(a):null;if(s===!0||s===!1)return s;const n=String(o||r||"").toUpperCase();return Array.isArray(t)?t.includes(n):!1}function m(a,t){const s=typeof h=="function"?h(a):null;if(s===!0||s===!1)return s;const n=String(o||r||"").toUpperCase();return Array.isArray(t)?t.includes(n):!1}const u=x("PORTAL_HR_FINAL_HOLD",["HR","ADMIN"]),[f,H]=c.useState(!1),[y,v]=c.useState([]),[S,j]=c.useState({}),[b,I]=c.useState("");async function A(){if(u&&m("HR_FINAL_HOLD_LIST",["HR","ADMIN"])){H(!0);try{const t=(await E(l)).items||[];v(t),j(s=>{const n={...s};return t.forEach(i=>{n[i.candidateId]||(n[i.candidateId]={finalHoldAt:U(i.finalHoldAt),remark:i.finalHoldRemark||""})}),n})}catch(a){d.error((a==null?void 0:a.message)||"Failed to load")}finally{H(!1)}}}c.useEffect(()=>{A()},[u]);const k=c.useMemo(()=>y.length,[y]);async function D(a){if(!m("HR_HOLD_SCHEDULE",["HR","ADMIN"])){d.error("Not allowed");return}const t=S[a.candidateId]||{},s=String(t.finalHoldAt||"").trim();if(!s){d.error("Select date/time");return}const n=W(s);if(!n.ok){d.error(n.message);return}const i=n.date,w=`${a.candidateId}:SCHEDULE`;I(w);try{await _(l,{requirementId:a.requirementId,candidateId:a.candidateId,finalHoldAt:i.toISOString(),remark:String(t.remark||"").trim()}),d.success("Scheduled"),v(g=>g.map(N=>N.candidateId===a.candidateId?{...N,finalHoldAt:i.toISOString(),finalHoldRemark:String(t.remark||"").trim()}:N))}catch(g){d.error((g==null?void 0:g.message)||"Failed")}finally{I("")}}function L(a){if(!(a!=null&&a.cvFileId)){d.error("CV not available");return}M(a.cvFileId,l)||d.error("Unable to open CV")}return e.jsxs(T,{children:[u?null:e.jsxs("div",{className:"card",style:{padding:12,marginBottom:12},children:[e.jsx("div",{style:{fontWeight:700},children:"Not allowed"}),e.jsx("div",{className:"small",style:{color:"var(--gray-600)"},children:"You donâ€™t have access to Final Hold portal."})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h1",{className:"page-title",children:"Final Hold Scheduling"}),e.jsx("p",{className:"page-subtitle",children:"Schedule final hold interviews for candidates"})]}),e.jsx("div",{className:"card",style:{marginBottom:"16px"},children:e.jsxs("div",{className:"row",style:{gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[e.jsxs("button",{className:"button",onClick:A,disabled:f,style:{display:"flex",alignItems:"center",gap:6},children:[f?e.jsx(C,{size:14}):null,"Refresh"]}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsxs("span",{className:"badge",children:[k," candidates"]})})]})}),f?e.jsx(F,{text:"Loading candidates..."}):e.jsx(O,{title:"Final Hold Candidates",subtitle:"Candidates awaiting final hold scheduling",badge:k,variant:"card",defaultOpen:!0,children:y.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:"ðŸ“‹"}),e.jsx("div",{className:"empty-state-text",children:"No candidates in Final Hold"})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:y.map(a=>{const t=S[a.candidateId]||{finalHoldAt:"",remark:""},s=b===`${a.candidateId}:SCHEDULE`;return e.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid var(--gray-200)"},children:e.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:16,flexWrap:"wrap"},children:[e.jsxs("div",{style:{minWidth:260,flex:1},children:[e.jsx("div",{style:{fontWeight:700,fontSize:"15px"},children:a.candidateName}),e.jsxs("div",{className:"small",style:{color:"var(--gray-500)",marginTop:2},children:[a.jobTitle?`${a.jobTitle} Â· `:"",a.jobRole," Â· ",a.mobile]}),e.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:[e.jsxs("span",{className:"badge",children:["Req: ",a.requirementId]}),e.jsx("span",{className:"badge",style:{background:"var(--primary)",color:"#fff"},children:String(a.status||"").toUpperCase()})]}),a.finalHoldAt?e.jsx("div",{style:{marginTop:8},children:e.jsxs("span",{className:"badge",style:{background:"#22c55e",color:"#fff"},children:["ðŸ“… ",$(a.finalHoldAt)]})}):null,a.finalHoldRemark?e.jsxs("div",{className:"small",style:{marginTop:8,color:"var(--gray-600)"},children:["Remark: ",a.finalHoldRemark]}):null]}),e.jsxs("div",{style:{display:"grid",gap:10,minWidth:260},children:[e.jsxs("label",{className:"small",style:{display:"grid",gap:4},children:[e.jsx("span",{style:{fontWeight:600},children:"Schedule date/time"}),e.jsx("input",{type:"datetime-local",value:t.finalHoldAt,onChange:n=>j(i=>({...i,[a.candidateId]:{...t,finalHoldAt:n.target.value}}))})]}),e.jsxs("label",{className:"small",style:{display:"grid",gap:4},children:[e.jsx("span",{style:{fontWeight:600},children:"Remark (optional)"}),e.jsx("input",{value:t.remark,onChange:n=>j(i=>({...i,[a.candidateId]:{...t,remark:n.target.value}})),placeholder:"Enter remark"})]}),e.jsxs("div",{className:"action-grid",children:[e.jsx("button",{className:"button",type:"button",onClick:()=>L(a),children:"ðŸ“„ View CV"}),e.jsxs("button",{className:"button primary",type:"button",onClick:()=>D(a),disabled:s||!!b||!m("HR_HOLD_SCHEDULE",["HR","ADMIN"]),children:[s?e.jsx(C,{size:14}):null,"Schedule"]})]})]})]})},a.candidateId)})})})]})}export{z as FinalHoldPage};
